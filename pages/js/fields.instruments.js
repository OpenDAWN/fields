!function t(n,e,r){function i(u,a){if(!e[u]){if(!n[u]){var s="function"==typeof require&&require;if(!a&&s)return s(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}var c=e[u]={exports:{}};n[u][0].call(c.exports,function(t){var e=n[u][1][t];return i(e?e:t)},c,c.exports,t,n,e,r)}return e[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(t,n,e){var r=t("underscore"),i={start:function(){this.started===!1&&(this.started=!0,this._start())},stop:function(){this.started===!0&&(this.started=!1,this._stop())},_start:function(){},_stop:function(){},restoreParams:function(t){var n=this;r.forEach(t,function(t){rhizome.send("/sys/resend",["/"+n.instrumentId+"/"+t])})}},o=e.BaseSound=function(t){this.mixer=fields.sound.audioContext.createGain(),this.mixer.gain.value=0,this.mixer.connect(fields.sound.audioContext.destination),this.started=!1,this.instrumentId=t};r.extend(o.prototype,i,{});var u=e.BaseControls=function(t){this.started=!1,this.instrumentId=t};r.extend(u.prototype,i,{show:function(){}})},{underscore:10}],2:[function(t,n,e){var r=(t("async"),t("underscore")),i=t("../utils/waa"),o=t("../utils/widgets"),u=t("./base"),a=["volume","state"];e.sound=function(t,n,e){var r=new s(t,n,e);return r};var s=function(t,n,e){u.BaseSound.call(this,t),this.trackId=rhizome.userId%e.length,this.soundUrl=e[this.trackId],this.buffer=null,this.bufferNode=null};r.extend(s.prototype,u.BaseSound.prototype,{load:function(t){var n=this;i.loadBuffer(this.soundUrl,function(e,r){e||(n.buffer=r,fields.log(n.instrumentId+" loaded, track "+n.trackId+" buffer length :"+n.buffer.length),n.restore()),t(e)})},setParameter:function(t,n){"note"===t&&n[0]===this.trackId&&this.started&&(this.bufferNode=audioContext.createBufferSource(),this.bufferNode.connect(this.mixer),this.bufferNode.buffer=this.buffer,this.bufferNode.start(0))},restore:function(){this.restoreParams(a)}}),e.controls=function(t,n,e){return new c(t,n,e)};var c=function(t,n,e){u.BaseControls.call(this,t),this.trackCount=e.length,this.tracks=e,this.stepCount=n,this.container=$("<div>",{"class":"instrument centralizedSequencer"}),this.currentStep=-1,this.tickEvent=null,this.grid=o.grid("normal",e.length,n),this.grid.elem.appendTo(this.container)};r.extend(c.prototype,u.BaseControls.prototype,{load:function(t){this.restoreParams(a),t()},setParameter:function(){},_start:function(){var t=this;this.currentStep=-1,this.tickEvent=fields.controls.clock.setTimeout(function(){t.currentStep=(t.currentStep+1)%t.stepCount,r.forEach(t.tracks,function(n,e){t.container.find(".track-"+e+" .step-"+t.currentStep).hasClass("active")&&rhizome.send("/"+t.instrumentId+"/note",[e])}),t.container.find(".step").removeClass("current"),t.container.find(".step-"+t.currentStep).addClass("current")},.2).repeat(.2)},_stop:function(){this.tickEvent.clear()},restore:function(){self.restoreParams(a)}})},{"../utils/waa":12,"../utils/widgets":13,"./base":1,async:8,underscore:10}],3:[function(t,n,e){var r=t("underscore"),i=t("async"),o=t("../utils/waa"),u=t("../utils/widgets"),a=t("./base"),s=["volume","sequence","state"];e.sound=function(t,n,e,r){var i=new c(t,n,e,r);return i};var c=function(t,n,e,r){a.BaseSound.call(this,t),this.stepCount=n,this.tracks=e,this.buffers=[],this._setTempo(r),this.sequence=[],this.bufferNode=null};r.extend(c.prototype,a.BaseSound.prototype,{load:function(t){var n=this;i.map(this.tracks,o.loadBuffer,function(e,r){e||(n.buffers=r,fields.log(n.instrumentId+" loaded, tempo "+n.tempo),n.restore(s)),t(e)})},_start:function(){this._playSequence()},_stop:function(){this.bufferNode.stop(0),this.bufferNode=null},restore:function(){this.restoreParams(s)},setParameter:function(t,n){if("sequence"===t){var e,i,o=[];for(e=0,i=1;e<n.length;e+=2,i+=2)o.push([n[e],n[i]]);this.sequence=r.sortBy(o,function(t){return t[1]}),this.started&&this._playSequence()}else"tempo"===t&&(this._setTempo(n[0]),this.started&&this._playSequence())},_setTempo:function(t){this.tempo=t,this.beatDurInSec=60/t,this.samplesPerBeat=this.beatDurInSec*fields.sound.audioContext.sampleRate,this.samplesPerLoop=this.samplesPerBeat*this.stepCount},_playSequence:function(){var t=this,n=fields.sound.audioContext.createBuffer(1,this.samplesPerLoop,fields.sound.audioContext.sampleRate),e=n.getChannelData(0);r.forEach(this.sequence,function(n){var r=n[1],i=n[0],o=t.samplesPerBeat*r,u=t.buffers[i].getChannelData(0);subarray=o+u.length>=e.length?u.subarray(0,e.length-o):u,e.set(subarray,o)}),this.bufferNode&&this.bufferNode.stop(0),this.bufferNode=fields.sound.audioContext.createBufferSource(),this.bufferNode.connect(this.mixer),this.bufferNode.loop=!0,this.bufferNode.buffer=n,this.bufferNode.start(0)}}),e.controls=function(t,n,e){return new l(t,n,e)};var l=function(t,n,e){a.BaseControls.call(this,t),this.stepCount=n,this.tracks=e;var r=this,i=(e.length,$("<div>",{"class":"instrument distributedSequencer"}));this.grid=u.grid("toggle",e.length,n),this.grid.elem.prependTo(i),$("<button>",{"class":"sendButton"}).appendTo(this.grid.elem.find(".buttonsContainer")).html("Send").click(function(){rhizome.send("/"+t+"/sequence",r.grid.getSequence())}),this.container=i};r.extend(l.prototype,a.BaseControls.prototype,{setParameter:function(t,n){"sequence"===t?this.grid.setSequence(n):fields.log("distributedSequencer unknown parameter "+t)},load:function(t){this.restoreParams(s),t()}})},{"../utils/waa":12,"../utils/widgets":13,"./base":1,async:8,underscore:10}],4:[function(t){fields.instruments={},fields.instruments.distributedSequencer=t("./distributedSequencer"),fields.instruments.centralizedSequencer=t("./centralizedSequencer"),fields.instruments.granulator=t("./granulator"),fields.instruments.whiteNoise=t("./whiteNoise"),fields.instruments.trigger=t("./trigger")},{"./centralizedSequencer":2,"./distributedSequencer":3,"./granulator":5,"./trigger":6,"./whiteNoise":7}],5:[function(t,n,e){var r=t("underscore"),i=t("../utils/waa"),o=t("../utils/widgets"),u=t("../utils/math"),a=t("./base"),s=["volume","position","duration","ratio","env","density","state"];e.sound=function(t,n){return new c(t,n)};var c=function(t,n){a.BaseSound.call(this,t),this.params={position:[0,0],duration:[.1,0],ratio:[1,0],env:0,density:0},this.url=n};r.extend(c.prototype,a.BaseSound.prototype,{load:function(t){var n=this;i.loadBuffer(this.url,function(e,r){e||(n.buffer=r,fields.log(n.instrumentId+" loaded, buffer length :"+n.buffer.length),n.restoreParams(s)),t(e)})},_start:function(){this.grainEvent&&this.grainEvent.clear();var t=this;0===fields.sound.clockUsers&&(fields.sound.clock.start(),fields.log("start clock")),fields.sound.clockUsers++,this.grainEvent=fields.sound.clock.setTimeout(function(){var n=t._getDuration();t._enjoyTheSilence()?t.grainEvent.repeat(n/2||.005):(n=t._playSound(t.url,t.mixer,t._getPosition(),n,t._getRatio(),t.params.env),t.grainEvent.repeat(n||.005))},.1).repeat(.1),this.grainEvent.on("expired",function(){fields.log("EXPIRED")})},_stop:function(){this.grainEvent&&this.grainEvent.clear(),fields.sound.clockUsers--,0===fields.sound.clockUsers&&(fields.sound.clock.stop(),fields.log("stop clock"))},restore:function(){this.restoreParams(s)},setParameter:function(t,n){this.params[t]=n},_getPosition:function(){var t=this.params.position[0]*(this.buffer.length/fields.sound.audioContext.sampleRate);return u.pickVal(t,this.params.position[1])},_getDuration:function(){var t=this.params.duration[0];return Math.max(.01,u.pickVal(4*u.valExp(t),this.params.duration[1]))},_getRatio:function(){var t=[.5,.75,1],n=this.params.ratio[0];return this.params.quantize_ratio?n*t[Math.floor(.99*Math.random()*t.length)]:Math.max(.05,u.pickVal(n,this.params.ratio[1]))},_enjoyTheSilence:function(){var t=Math.random()>this.params.density,n=Math.random()>this.params.density;return t||n},_playSound:function(t,n,e,r,i,o){var u=this.buffer.length/fields.sound.audioContext.sampleRate,a=u-e;if(r=Math.min(a/i,r),0>=r)return 0;var s=fields.sound.audioContext.createBufferSource(),c=fields.sound.audioContext.createGain();s.playbackRate.value=i,s.buffer=this.buffer;var l=Math.max(r*(o/2),.002);return c.gain.setValueAtTime(0,fields.sound.audioContext.currentTime),c.gain.linearRampToValueAtTime(1,fields.sound.audioContext.currentTime+l),c.gain.linearRampToValueAtTime(1,fields.sound.audioContext.currentTime+r-l),c.gain.linearRampToValueAtTime(0,fields.sound.audioContext.currentTime+r),s.connect(c),c.connect(n),s.start(0,e,r),r}}),e.controls=function(t,n){return new l(t,n)};var l=function(t){a.BaseControls.call(this,t),this.container=$("<div>",{"class":"instrument granulator"});var n=200,e=rhizome.utils.throttle(n,function(n){rhizome.send("/"+t+"/density",n)});this.densitySlider=o.slider({title:"density"},function(t){e([t])}),this.densitySlider.elem.appendTo(this.container);var r=rhizome.utils.throttle(n,function(n){rhizome.send("/"+t+"/env",n)});this.envSlider=o.slider({title:"enveloppe"},function(t){r([t])}),this.envSlider.elem.appendTo(this.container);var i=rhizome.utils.throttle(n,function(n){rhizome.send("/"+t+"/duration",n)});this.durationPad=o.xyPad({title:"duration",xLabel:"mean",yLabel:"variance"},function(t,n){i([t,n])}),this.durationPad.elem.appendTo(this.container);var u=rhizome.utils.throttle(n,function(n){rhizome.send("/"+t+"/position",n)});this.positionPad=o.xyPad({title:"position",xLabel:"mean",yLabel:"variance"},function(t,n){u([t,n])}),this.positionPad.elem.appendTo(this.container);var s=rhizome.utils.throttle(n,function(n){rhizome.send("/"+t+"/ratio",n)});this.ratioPad=o.xyPad({title:"ratio",xLabel:"mean",yLabel:"variance"},function(t,n){s([t,n])}),this.ratioPad.elem.appendTo(this.container)};r.extend(l.prototype,a.BaseControls.prototype,{show:function(){this.durationPad.refresh(),this.positionPad.refresh(),this.ratioPad.refresh(),this.densitySlider.refresh(),this.envSlider.refresh()},load:function(t){this.restoreParams(s),t()},setParameter:function(t,n){"duration"===t?this.durationPad.setPosition(n):"position"===t?this.positionPad.setPosition(n):"ratio"===t?this.ratioPad.setPosition(n):"density"===t?this.densitySlider.setVal(n[0]):"env"===t?this.envSlider.setVal(n[0]):fields.log("Unknown parameter "+t)}})},{"../utils/math":11,"../utils/waa":12,"../utils/widgets":13,"./base":1,underscore:10}],6:[function(t,n,e){var r=t("underscore"),i=t("../utils/waa"),o=(t("../utils/widgets"),t("../utils/math"),t("./base")),u=["volume"];e.sound=function(t,n){return new a(t,n)};var a=function(t,n){o.BaseSound.call(this,t),this.url=n};r.extend(a.prototype,o.BaseSound.prototype,{load:function(t){var n=this;i.loadBuffer(this.url,function(e,r){e||(n.buffer=r,fields.log(n.instrumentId+" loaded, buffer length :"+n.buffer.length),n.restoreParams(u)),t(e)})},_start:function(){this.bufferNode=fields.sound.audioContext.createBufferSource(),this.bufferNode.buffer=this.buffer,this.bufferNode.connect(this.mixer),this.bufferNode.start(0)},_stop:function(){},restore:function(){this.restoreParams(u)},setParameter:function(){}}),e.controls=function(t,n){return new s(t,n)};var s=function(t){o.BaseControls.call(this,t),this.container=$("<div>",{"class":"instrument trigger"})};r.extend(s.prototype,o.BaseControls.prototype,{load:function(t){this.restoreParams(u),t()}})},{"../utils/math":11,"../utils/waa":12,"../utils/widgets":13,"./base":1,underscore:10}],7:[function(t,n,e){var r=(t("async"),t("underscore")),i=(t("../utils/waa"),t("./base")),o=["volume","state"];e.sound=function(t){var n=new u(t);return n};var u=function(t){i.BaseSound.call(this,t);var n=44100;this.noiseBuffer=fields.sound.audioContext.createBuffer(1,n,44100);var e,r=this.noiseBuffer.getChannelData(0);for(e=0;n>e;e++)r[e]=Math.random()};r.extend(u.prototype,i.BaseSound.prototype,{load:function(t){this.restoreParams(o),t()},_start:function(){this.bufferNode=fields.sound.audioContext.createBufferSource(),this.bufferNode.buffer=this.noiseBuffer,this.bufferNode.loop=!0,this.bufferNode.connect(this.mixer),this.bufferNode.start(0)},_stop:function(){this.bufferNode.stop(0)},restore:function(){this.restoreParams(o)},setParameter:function(){}}),e.controls=function(t){return new a(t)};var a=function(t){i.BaseControls.call(this,t),this.container=$("<div>",{"class":"instrument whiteNoise"})};r.extend(a.prototype,i.BaseControls.prototype,{load:function(t){this.restoreParams(o),t()}})},{"../utils/waa":12,"./base":1,async:8,underscore:10}],8:[function(t,n){(function(t){!function(){function e(t){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,t.apply(r,arguments)}}var r,i,o={};r=this,null!=r&&(i=r.async),o.noConflict=function(){return r.async=i,o};var u=Object.prototype.toString,a=Array.isArray||function(t){return"[object Array]"===u.call(t)},s=function(t,n){if(t.forEach)return t.forEach(n);for(var e=0;e<t.length;e+=1)n(t[e],e,t)},c=function(t,n){if(t.map)return t.map(n);var e=[];return s(t,function(t,r,i){e.push(n(t,r,i))}),e},l=function(t,n,e){return t.reduce?t.reduce(n,e):(s(t,function(t,r,i){e=n(e,t,r,i)}),e)},f=function(t){if(Object.keys)return Object.keys(t);var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e);return n};"undefined"!=typeof t&&t.nextTick?(o.nextTick=t.nextTick,o.setImmediate="undefined"!=typeof setImmediate?function(t){setImmediate(t)}:o.nextTick):"function"==typeof setImmediate?(o.nextTick=function(t){setImmediate(t)},o.setImmediate=o.nextTick):(o.nextTick=function(t){setTimeout(t,0)},o.setImmediate=o.nextTick),o.each=function(t,n,r){function i(n){n?(r(n),r=function(){}):(o+=1,o>=t.length&&r())}if(r=r||function(){},!t.length)return r();var o=0;s(t,function(t){n(t,e(i))})},o.forEach=o.each,o.eachSeries=function(t,n,e){if(e=e||function(){},!t.length)return e();var r=0,i=function(){n(t[r],function(n){n?(e(n),e=function(){}):(r+=1,r>=t.length?e():i())})};i()},o.forEachSeries=o.eachSeries,o.eachLimit=function(t,n,e,r){var i=d(n);i.apply(null,[t,e,r])},o.forEachLimit=o.eachLimit;var d=function(t){return function(n,e,r){if(r=r||function(){},!n.length||0>=t)return r();var i=0,o=0,u=0;!function a(){if(i>=n.length)return r();for(;t>u&&o<n.length;)o+=1,u+=1,e(n[o-1],function(t){t?(r(t),r=function(){}):(i+=1,u-=1,i>=n.length?r():a())})}()}},p=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[o.each].concat(n))}},h=function(t,n){return function(){var e=Array.prototype.slice.call(arguments);return n.apply(null,[d(t)].concat(e))}},v=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[o.eachSeries].concat(n))}},m=function(t,n,e,r){if(n=c(n,function(t,n){return{index:n,value:t}}),r){var i=[];t(n,function(t,n){e(t.value,function(e,r){i[t.index]=r,n(e)})},function(t){r(t,i)})}else t(n,function(t,n){e(t.value,function(t){n(t)})})};o.map=p(m),o.mapSeries=v(m),o.mapLimit=function(t,n,e,r){return g(n)(t,e,r)};var g=function(t){return h(t,m)};o.reduce=function(t,n,e,r){o.eachSeries(t,function(t,r){e(n,t,function(t,e){n=e,r(t)})},function(t){r(t,n)})},o.inject=o.reduce,o.foldl=o.reduce,o.reduceRight=function(t,n,e,r){var i=c(t,function(t){return t}).reverse();o.reduce(i,n,e,r)},o.foldr=o.reduceRight;var y=function(t,n,e,r){var i=[];n=c(n,function(t,n){return{index:n,value:t}}),t(n,function(t,n){e(t.value,function(e){e&&i.push(t),n()})},function(){r(c(i.sort(function(t,n){return t.index-n.index}),function(t){return t.value}))})};o.filter=p(y),o.filterSeries=v(y),o.select=o.filter,o.selectSeries=o.filterSeries;var b=function(t,n,e,r){var i=[];n=c(n,function(t,n){return{index:n,value:t}}),t(n,function(t,n){e(t.value,function(e){e||i.push(t),n()})},function(){r(c(i.sort(function(t,n){return t.index-n.index}),function(t){return t.value}))})};o.reject=p(b),o.rejectSeries=v(b);var x=function(t,n,e,r){t(n,function(t,n){e(t,function(e){e?(r(t),r=function(){}):n()})},function(){r()})};o.detect=p(x),o.detectSeries=v(x),o.some=function(t,n,e){o.each(t,function(t,r){n(t,function(t){t&&(e(!0),e=function(){}),r()})},function(){e(!1)})},o.any=o.some,o.every=function(t,n,e){o.each(t,function(t,r){n(t,function(t){t||(e(!1),e=function(){}),r()})},function(){e(!0)})},o.all=o.every,o.sortBy=function(t,n,e){o.map(t,function(t,e){n(t,function(n,r){n?e(n):e(null,{value:t,criteria:r})})},function(t,n){if(t)return e(t);var r=function(t,n){var e=t.criteria,r=n.criteria;return r>e?-1:e>r?1:0};e(null,c(n.sort(r),function(t){return t.value}))})},o.auto=function(t,n){n=n||function(){};var e=f(t),r=e.length;if(!r)return n();var i={},u=[],c=function(t){u.unshift(t)},d=function(t){for(var n=0;n<u.length;n+=1)if(u[n]===t)return void u.splice(n,1)},p=function(){r--,s(u.slice(0),function(t){t()})};c(function(){if(!r){var t=n;n=function(){},t(null,i)}}),s(e,function(e){var r=a(t[e])?t[e]:[t[e]],u=function(t){var r=Array.prototype.slice.call(arguments,1);if(r.length<=1&&(r=r[0]),t){var u={};s(f(i),function(t){u[t]=i[t]}),u[e]=r,n(t,u),n=function(){}}else i[e]=r,o.setImmediate(p)},h=r.slice(0,Math.abs(r.length-1))||[],v=function(){return l(h,function(t,n){return t&&i.hasOwnProperty(n)},!0)&&!i.hasOwnProperty(e)};if(v())r[r.length-1](u,i);else{var m=function(){v()&&(d(m),r[r.length-1](u,i))};c(m)}})},o.retry=function(t,n,e){var r=5,i=[];"function"==typeof t&&(e=n,n=t,t=r),t=parseInt(t,10)||r;var u=function(r,u){for(var a=function(t,n){return function(e){t(function(t,r){e(!t||n,{err:t,result:r})},u)}};t;)i.push(a(n,!(t-=1)));o.series(i,function(t,n){n=n[n.length-1],(r||e)(n.err,n.result)})};return e?u():u},o.waterfall=function(t,n){if(n=n||function(){},!a(t)){var e=new Error("First argument to waterfall must be an array of functions");return n(e)}if(!t.length)return n();var r=function(t){return function(e){if(e)n.apply(null,arguments),n=function(){};else{var i=Array.prototype.slice.call(arguments,1),u=t.next();i.push(u?r(u):n),o.setImmediate(function(){t.apply(null,i)})}}};r(o.iterator(t))()};var w=function(t,n,e){if(e=e||function(){},a(n))t.map(n,function(t,n){t&&t(function(t){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),n.call(null,t,e)})},e);else{var r={};t.each(f(n),function(t,e){n[t](function(n){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[t]=i,e(n)})},function(t){e(t,r)})}};o.parallel=function(t,n){w({map:o.map,each:o.each},t,n)},o.parallelLimit=function(t,n,e){w({map:g(n),each:d(n)},t,e)},o.series=function(t,n){if(n=n||function(){},a(t))o.mapSeries(t,function(t,n){t&&t(function(t){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),n.call(null,t,e)})},n);else{var e={};o.eachSeries(f(t),function(n,r){t[n](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),e[n]=i,r(t)})},function(t){n(t,e)})}},o.iterator=function(t){var n=function(e){var r=function(){return t.length&&t[e].apply(null,arguments),r.next()};return r.next=function(){return e<t.length-1?n(e+1):null},r};return n(0)},o.apply=function(t){var n=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,n.concat(Array.prototype.slice.call(arguments)))}};var k=function(t,n,e,r){var i=[];t(n,function(t,n){e(t,function(t,e){i=i.concat(e||[]),n(t)})},function(t){r(t,i)})};o.concat=p(k),o.concatSeries=v(k),o.whilst=function(t,n,e){t()?n(function(r){return r?e(r):void o.whilst(t,n,e)}):e()},o.doWhilst=function(t,n,e){t(function(r){if(r)return e(r);var i=Array.prototype.slice.call(arguments,1);n.apply(null,i)?o.doWhilst(t,n,e):e()})},o.until=function(t,n,e){t()?e():n(function(r){return r?e(r):void o.until(t,n,e)})},o.doUntil=function(t,n,e){t(function(r){if(r)return e(r);var i=Array.prototype.slice.call(arguments,1);n.apply(null,i)?e():o.doUntil(t,n,e)})},o.queue=function(t,n){function r(t,n,e,r){return t.started||(t.started=!0),a(n)||(n=[n]),0==n.length?o.setImmediate(function(){t.drain&&t.drain()}):void s(n,function(n){var i={data:n,callback:"function"==typeof r?r:null};e?t.tasks.unshift(i):t.tasks.push(i),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),o.setImmediate(t.process)})}void 0===n&&(n=1);var i=0,u={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(t,n){r(u,t,!1,n)},kill:function(){u.drain=null,u.tasks=[]},unshift:function(t,n){r(u,t,!0,n)},process:function(){if(!u.paused&&i<u.concurrency&&u.tasks.length){var n=u.tasks.shift();u.empty&&0===u.tasks.length&&u.empty(),i+=1;var r=function(){i-=1,n.callback&&n.callback.apply(n,arguments),u.drain&&u.tasks.length+i===0&&u.drain(),u.process()},o=e(r);t(n.data,o)}},length:function(){return u.tasks.length},running:function(){return i},idle:function(){return u.tasks.length+i===0},pause:function(){u.paused!==!0&&(u.paused=!0,u.process())},resume:function(){u.paused!==!1&&(u.paused=!1,u.process())}};return u},o.priorityQueue=function(t,n){function e(t,n){return t.priority-n.priority}function r(t,n,e){for(var r=-1,i=t.length-1;i>r;){var o=r+(i-r+1>>>1);e(n,t[o])>=0?r=o:i=o-1}return r}function i(t,n,i,u){return t.started||(t.started=!0),a(n)||(n=[n]),0==n.length?o.setImmediate(function(){t.drain&&t.drain()}):void s(n,function(n){var a={data:n,priority:i,callback:"function"==typeof u?u:null};t.tasks.splice(r(t.tasks,a,e)+1,0,a),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),o.setImmediate(t.process)})}var u=o.queue(t,n);return u.push=function(t,n,e){i(u,t,n,e)},delete u.unshift,u},o.cargo=function(t,n){var e=!1,r=[],i={tasks:r,payload:n,saturated:null,empty:null,drain:null,drained:!0,push:function(t,e){a(t)||(t=[t]),s(t,function(t){r.push({data:t,callback:"function"==typeof e?e:null}),i.drained=!1,i.saturated&&r.length===n&&i.saturated()}),o.setImmediate(i.process)},process:function u(){if(!e){if(0===r.length)return i.drain&&!i.drained&&i.drain(),void(i.drained=!0);var o="number"==typeof n?r.splice(0,n):r.splice(0,r.length),a=c(o,function(t){return t.data});i.empty&&i.empty(),e=!0,t(a,function(){e=!1;var t=arguments;s(o,function(n){n.callback&&n.callback.apply(null,t)}),u()})}},length:function(){return r.length},running:function(){return e}};return i};var S=function(t){return function(n){var e=Array.prototype.slice.call(arguments,1);n.apply(null,e.concat([function(n){var e=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(n?console.error&&console.error(n):console[t]&&s(e,function(n){console[t](n)}))}]))}};o.log=S("log"),o.dir=S("dir"),o.memoize=function(t,n){var e={},r={};n=n||function(t){return t};var i=function(){var i=Array.prototype.slice.call(arguments),u=i.pop(),a=n.apply(null,i);a in e?o.nextTick(function(){u.apply(null,e[a])}):a in r?r[a].push(u):(r[a]=[u],t.apply(null,i.concat([function(){e[a]=arguments;var t=r[a];delete r[a];for(var n=0,i=t.length;i>n;n++)t[n].apply(null,arguments)}])))};return i.memo=e,i.unmemoized=t,i},o.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},o.times=function(t,n,e){for(var r=[],i=0;t>i;i++)r.push(i);return o.map(r,n,e)},o.timesSeries=function(t,n,e){for(var r=[],i=0;t>i;i++)r.push(i);return o.mapSeries(r,n,e)},o.seq=function(){var t=arguments;return function(){var n=this,e=Array.prototype.slice.call(arguments),r=e.pop();o.reduce(t,e,function(t,e,r){e.apply(n,t.concat([function(){var t=arguments[0],n=Array.prototype.slice.call(arguments,1);r(t,n)}]))},function(t,e){r.apply(n,[t].concat(e))})}},o.compose=function(){return o.seq.apply(null,Array.prototype.reverse.call(arguments))};var _=function(t,n){var e=function(){var e=this,r=Array.prototype.slice.call(arguments),i=r.pop();return t(n,function(t,n){t.apply(e,r.concat([n]))},i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return e.apply(this,r)}return e};o.applyEach=p(_),o.applyEachSeries=v(_),o.forever=function(t,n){function e(r){if(r){if(n)return n(r);throw r}t(e)}e()},"undefined"!=typeof n&&n.exports?n.exports=o:"undefined"!=typeof define&&define.amd?define([],function(){return o}):r.async=o}()}).call(this,t("1YiZ5S"))},{"1YiZ5S":9}],9:[function(t,n){function e(){}var r=n.exports={};r.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(n){var e=[];return window.addEventListener("message",function(t){var n=t.source;if((n===window||null===n)&&"process-tick"===t.data&&(t.stopPropagation(),e.length>0)){var r=e.shift();r()}},!0),function(t){e.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=e,r.addListener=e,r.once=e,r.off=e,r.removeListener=e,r.removeAllListeners=e,r.emit=e,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")}},{}],10:[function(t,n,e){(function(){var t=this,r=t._,i={},o=Array.prototype,u=Object.prototype,a=Function.prototype,s=o.push,c=o.slice,l=o.concat,f=u.toString,d=u.hasOwnProperty,p=o.forEach,h=o.map,v=o.reduce,m=o.reduceRight,g=o.filter,y=o.every,b=o.some,x=o.indexOf,w=o.lastIndexOf,k=Array.isArray,S=Object.keys,_=a.bind,T=function(t){return t instanceof T?t:this instanceof T?void(this._wrapped=t):new T(t)};"undefined"!=typeof e?("undefined"!=typeof n&&n.exports&&(e=n.exports=T),e._=T):t._=T,T.VERSION="1.6.0";var E=T.each=T.forEach=function(t,n,e){if(null==t)return t;if(p&&t.forEach===p)t.forEach(n,e);else if(t.length===+t.length){for(var r=0,o=t.length;o>r;r++)if(n.call(e,t[r],r,t)===i)return}else for(var u=T.keys(t),r=0,o=u.length;o>r;r++)if(n.call(e,t[u[r]],u[r],t)===i)return;return t};T.map=T.collect=function(t,n,e){var r=[];return null==t?r:h&&t.map===h?t.map(n,e):(E(t,function(t,i,o){r.push(n.call(e,t,i,o))}),r)};var C="Reduce of empty array with no initial value";T.reduce=T.foldl=T.inject=function(t,n,e,r){var i=arguments.length>2;if(null==t&&(t=[]),v&&t.reduce===v)return r&&(n=T.bind(n,r)),i?t.reduce(n,e):t.reduce(n);if(E(t,function(t,o,u){i?e=n.call(r,e,t,o,u):(e=t,i=!0)}),!i)throw new TypeError(C);return e},T.reduceRight=T.foldr=function(t,n,e,r){var i=arguments.length>2;if(null==t&&(t=[]),m&&t.reduceRight===m)return r&&(n=T.bind(n,r)),i?t.reduceRight(n,e):t.reduceRight(n);var o=t.length;if(o!==+o){var u=T.keys(t);o=u.length}if(E(t,function(a,s,c){s=u?u[--o]:--o,i?e=n.call(r,e,t[s],s,c):(e=t[s],i=!0)}),!i)throw new TypeError(C);return e},T.find=T.detect=function(t,n,e){var r;return P(t,function(t,i,o){return n.call(e,t,i,o)?(r=t,!0):void 0}),r},T.filter=T.select=function(t,n,e){var r=[];return null==t?r:g&&t.filter===g?t.filter(n,e):(E(t,function(t,i,o){n.call(e,t,i,o)&&r.push(t)}),r)},T.reject=function(t,n,e){return T.filter(t,function(t,r,i){return!n.call(e,t,r,i)},e)},T.every=T.all=function(t,n,e){n||(n=T.identity);var r=!0;return null==t?r:y&&t.every===y?t.every(n,e):(E(t,function(t,o,u){return(r=r&&n.call(e,t,o,u))?void 0:i}),!!r)};var P=T.some=T.any=function(t,n,e){n||(n=T.identity);var r=!1;return null==t?r:b&&t.some===b?t.some(n,e):(E(t,function(t,o,u){return r||(r=n.call(e,t,o,u))?i:void 0}),!!r)};T.contains=T.include=function(t,n){return null==t?!1:x&&t.indexOf===x?-1!=t.indexOf(n):P(t,function(t){return t===n})},T.invoke=function(t,n){var e=c.call(arguments,2),r=T.isFunction(n);return T.map(t,function(t){return(r?n:t[n]).apply(t,e)})},T.pluck=function(t,n){return T.map(t,T.property(n))},T.where=function(t,n){return T.filter(t,T.matches(n))},T.findWhere=function(t,n){return T.find(t,T.matches(n))},T.max=function(t,n,e){if(!n&&T.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);var r=-1/0,i=-1/0;return E(t,function(t,o,u){var a=n?n.call(e,t,o,u):t;a>i&&(r=t,i=a)}),r},T.min=function(t,n,e){if(!n&&T.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);var r=1/0,i=1/0;return E(t,function(t,o,u){var a=n?n.call(e,t,o,u):t;i>a&&(r=t,i=a)}),r},T.shuffle=function(t){var n,e=0,r=[];return E(t,function(t){n=T.random(e++),r[e-1]=r[n],r[n]=t}),r},T.sample=function(t,n,e){return null==n||e?(t.length!==+t.length&&(t=T.values(t)),t[T.random(t.length-1)]):T.shuffle(t).slice(0,Math.max(0,n))};var A=function(t){return null==t?T.identity:T.isFunction(t)?t:T.property(t)};T.sortBy=function(t,n,e){return n=A(n),T.pluck(T.map(t,function(t,r,i){return{value:t,index:r,criteria:n.call(e,t,r,i)}}).sort(function(t,n){var e=t.criteria,r=n.criteria;if(e!==r){if(e>r||void 0===e)return 1;if(r>e||void 0===r)return-1}return t.index-n.index}),"value")};var M=function(t){return function(n,e,r){var i={};return e=A(e),E(n,function(o,u){var a=e.call(r,o,u,n);t(i,a,o)}),i}};T.groupBy=M(function(t,n,e){T.has(t,n)?t[n].push(e):t[n]=[e]}),T.indexBy=M(function(t,n,e){t[n]=e}),T.countBy=M(function(t,n){T.has(t,n)?t[n]++:t[n]=1}),T.sortedIndex=function(t,n,e,r){e=A(e);for(var i=e.call(r,n),o=0,u=t.length;u>o;){var a=o+u>>>1;e.call(r,t[a])<i?o=a+1:u=a}return o},T.toArray=function(t){return t?T.isArray(t)?c.call(t):t.length===+t.length?T.map(t,T.identity):T.values(t):[]},T.size=function(t){return null==t?0:t.length===+t.length?t.length:T.keys(t).length},T.first=T.head=T.take=function(t,n,e){return null==t?void 0:null==n||e?t[0]:0>n?[]:c.call(t,0,n)},T.initial=function(t,n,e){return c.call(t,0,t.length-(null==n||e?1:n))},T.last=function(t,n,e){return null==t?void 0:null==n||e?t[t.length-1]:c.call(t,Math.max(t.length-n,0))},T.rest=T.tail=T.drop=function(t,n,e){return c.call(t,null==n||e?1:n)},T.compact=function(t){return T.filter(t,T.identity)};var B=function(t,n,e){return n&&T.every(t,T.isArray)?l.apply(e,t):(E(t,function(t){T.isArray(t)||T.isArguments(t)?n?s.apply(e,t):B(t,n,e):e.push(t)}),e)};T.flatten=function(t,n){return B(t,n,[])},T.without=function(t){return T.difference(t,c.call(arguments,1))},T.partition=function(t,n){var e=[],r=[];return E(t,function(t){(n(t)?e:r).push(t)}),[e,r]},T.uniq=T.unique=function(t,n,e,r){T.isFunction(n)&&(r=e,e=n,n=!1);var i=e?T.map(t,e,r):t,o=[],u=[];return E(i,function(e,r){(n?r&&u[u.length-1]===e:T.contains(u,e))||(u.push(e),o.push(t[r]))}),o},T.union=function(){return T.uniq(T.flatten(arguments,!0))},T.intersection=function(t){var n=c.call(arguments,1);return T.filter(T.uniq(t),function(t){return T.every(n,function(n){return T.contains(n,t)})})},T.difference=function(t){var n=l.apply(o,c.call(arguments,1));return T.filter(t,function(t){return!T.contains(n,t)})},T.zip=function(){for(var t=T.max(T.pluck(arguments,"length").concat(0)),n=new Array(t),e=0;t>e;e++)n[e]=T.pluck(arguments,""+e);return n},T.object=function(t,n){if(null==t)return{};for(var e={},r=0,i=t.length;i>r;r++)n?e[t[r]]=n[r]:e[t[r][0]]=t[r][1];return e},T.indexOf=function(t,n,e){if(null==t)return-1;var r=0,i=t.length;if(e){if("number"!=typeof e)return r=T.sortedIndex(t,n),t[r]===n?r:-1;r=0>e?Math.max(0,i+e):e}if(x&&t.indexOf===x)return t.indexOf(n,e);for(;i>r;r++)if(t[r]===n)return r;return-1},T.lastIndexOf=function(t,n,e){if(null==t)return-1;var r=null!=e;if(w&&t.lastIndexOf===w)return r?t.lastIndexOf(n,e):t.lastIndexOf(n);for(var i=r?e:t.length;i--;)if(t[i]===n)return i;return-1},T.range=function(t,n,e){arguments.length<=1&&(n=t||0,t=0),e=arguments[2]||1;for(var r=Math.max(Math.ceil((n-t)/e),0),i=0,o=new Array(r);r>i;)o[i++]=t,t+=e;return o};var q=function(){};T.bind=function(t,n){var e,r;if(_&&t.bind===_)return _.apply(t,c.call(arguments,1));if(!T.isFunction(t))throw new TypeError;return e=c.call(arguments,2),r=function(){if(!(this instanceof r))return t.apply(n,e.concat(c.call(arguments)));q.prototype=t.prototype;var i=new q;q.prototype=null;var o=t.apply(i,e.concat(c.call(arguments)));return Object(o)===o?o:i}},T.partial=function(t){var n=c.call(arguments,1);return function(){for(var e=0,r=n.slice(),i=0,o=r.length;o>i;i++)r[i]===T&&(r[i]=arguments[e++]);for(;e<arguments.length;)r.push(arguments[e++]);return t.apply(this,r)}},T.bindAll=function(t){var n=c.call(arguments,1);if(0===n.length)throw new Error("bindAll must be passed function names");return E(n,function(n){t[n]=T.bind(t[n],t)}),t},T.memoize=function(t,n){var e={};return n||(n=T.identity),function(){var r=n.apply(this,arguments);return T.has(e,r)?e[r]:e[r]=t.apply(this,arguments)}},T.delay=function(t,n){var e=c.call(arguments,2);
return setTimeout(function(){return t.apply(null,e)},n)},T.defer=function(t){return T.delay.apply(T,[t,1].concat(c.call(arguments,1)))},T.throttle=function(t,n,e){var r,i,o,u=null,a=0;e||(e={});var s=function(){a=e.leading===!1?0:T.now(),u=null,o=t.apply(r,i),r=i=null};return function(){var c=T.now();a||e.leading!==!1||(a=c);var l=n-(c-a);return r=this,i=arguments,0>=l?(clearTimeout(u),u=null,a=c,o=t.apply(r,i),r=i=null):u||e.trailing===!1||(u=setTimeout(s,l)),o}},T.debounce=function(t,n,e){var r,i,o,u,a,s=function(){var c=T.now()-u;n>c?r=setTimeout(s,n-c):(r=null,e||(a=t.apply(o,i),o=i=null))};return function(){o=this,i=arguments,u=T.now();var c=e&&!r;return r||(r=setTimeout(s,n)),c&&(a=t.apply(o,i),o=i=null),a}},T.once=function(t){var n,e=!1;return function(){return e?n:(e=!0,n=t.apply(this,arguments),t=null,n)}},T.wrap=function(t,n){return T.partial(n,t)},T.compose=function(){var t=arguments;return function(){for(var n=arguments,e=t.length-1;e>=0;e--)n=[t[e].apply(this,n)];return n[0]}},T.after=function(t,n){return function(){return--t<1?n.apply(this,arguments):void 0}},T.keys=function(t){if(!T.isObject(t))return[];if(S)return S(t);var n=[];for(var e in t)T.has(t,e)&&n.push(e);return n},T.values=function(t){for(var n=T.keys(t),e=n.length,r=new Array(e),i=0;e>i;i++)r[i]=t[n[i]];return r},T.pairs=function(t){for(var n=T.keys(t),e=n.length,r=new Array(e),i=0;e>i;i++)r[i]=[n[i],t[n[i]]];return r},T.invert=function(t){for(var n={},e=T.keys(t),r=0,i=e.length;i>r;r++)n[t[e[r]]]=e[r];return n},T.functions=T.methods=function(t){var n=[];for(var e in t)T.isFunction(t[e])&&n.push(e);return n.sort()},T.extend=function(t){return E(c.call(arguments,1),function(n){if(n)for(var e in n)t[e]=n[e]}),t},T.pick=function(t){var n={},e=l.apply(o,c.call(arguments,1));return E(e,function(e){e in t&&(n[e]=t[e])}),n},T.omit=function(t){var n={},e=l.apply(o,c.call(arguments,1));for(var r in t)T.contains(e,r)||(n[r]=t[r]);return n},T.defaults=function(t){return E(c.call(arguments,1),function(n){if(n)for(var e in n)void 0===t[e]&&(t[e]=n[e])}),t},T.clone=function(t){return T.isObject(t)?T.isArray(t)?t.slice():T.extend({},t):t},T.tap=function(t,n){return n(t),t};var N=function(t,n,e,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;t instanceof T&&(t=t._wrapped),n instanceof T&&(n=n._wrapped);var i=f.call(t);if(i!=f.call(n))return!1;switch(i){case"[object String]":return t==String(n);case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;for(var o=e.length;o--;)if(e[o]==t)return r[o]==n;var u=t.constructor,a=n.constructor;if(u!==a&&!(T.isFunction(u)&&u instanceof u&&T.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in n)return!1;e.push(t),r.push(n);var s=0,c=!0;if("[object Array]"==i){if(s=t.length,c=s==n.length)for(;s--&&(c=N(t[s],n[s],e,r)););}else{for(var l in t)if(T.has(t,l)&&(s++,!(c=T.has(n,l)&&N(t[l],n[l],e,r))))break;if(c){for(l in n)if(T.has(n,l)&&!s--)break;c=!s}}return e.pop(),r.pop(),c};T.isEqual=function(t,n){return N(t,n,[],[])},T.isEmpty=function(t){if(null==t)return!0;if(T.isArray(t)||T.isString(t))return 0===t.length;for(var n in t)if(T.has(t,n))return!1;return!0},T.isElement=function(t){return!(!t||1!==t.nodeType)},T.isArray=k||function(t){return"[object Array]"==f.call(t)},T.isObject=function(t){return t===Object(t)},E(["Arguments","Function","String","Number","Date","RegExp"],function(t){T["is"+t]=function(n){return f.call(n)=="[object "+t+"]"}}),T.isArguments(arguments)||(T.isArguments=function(t){return!(!t||!T.has(t,"callee"))}),"function"!=typeof/./&&(T.isFunction=function(t){return"function"==typeof t}),T.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},T.isNaN=function(t){return T.isNumber(t)&&t!=+t},T.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==f.call(t)},T.isNull=function(t){return null===t},T.isUndefined=function(t){return void 0===t},T.has=function(t,n){return d.call(t,n)},T.noConflict=function(){return t._=r,this},T.identity=function(t){return t},T.constant=function(t){return function(){return t}},T.property=function(t){return function(n){return n[t]}},T.matches=function(t){return function(n){if(n===t)return!0;for(var e in t)if(t[e]!==n[e])return!1;return!0}},T.times=function(t,n,e){for(var r=Array(Math.max(0,t)),i=0;t>i;i++)r[i]=n.call(e,i);return r},T.random=function(t,n){return null==n&&(n=t,t=0),t+Math.floor(Math.random()*(n-t+1))},T.now=Date.now||function(){return(new Date).getTime()};var j={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};j.unescape=T.invert(j.escape);var I={escape:new RegExp("["+T.keys(j.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(j.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(t){T[t]=function(n){return null==n?"":(""+n).replace(I[t],function(n){return j[t][n]})}}),T.result=function(t,n){if(null==t)return void 0;var e=t[n];return T.isFunction(e)?e.call(t):e},T.mixin=function(t){E(T.functions(t),function(n){var e=T[n]=t[n];T.prototype[n]=function(){var t=[this._wrapped];return s.apply(t,arguments),L.call(this,e.apply(T,t))}})};var O=0;T.uniqueId=function(t){var n=++O+"";return t?t+n:n},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var $=/(.)^/,R={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},z=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(t,n,e){var r;e=T.defaults({},e,T.templateSettings);var i=new RegExp([(e.escape||$).source,(e.interpolate||$).source,(e.evaluate||$).source].join("|")+"|$","g"),o=0,u="__p+='";t.replace(i,function(n,e,r,i,a){return u+=t.slice(o,a).replace(z,function(t){return"\\"+R[t]}),e&&(u+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'"),r&&(u+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(u+="';\n"+i+"\n__p+='"),o=a+n.length,n}),u+="';\n",e.variable||(u="with(obj||{}){\n"+u+"}\n"),u="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+u+"return __p;\n";try{r=new Function(e.variable||"obj","_",u)}catch(a){throw a.source=u,a}if(n)return r(n,T);var s=function(t){return r.call(this,t,T)};return s.source="function("+(e.variable||"obj")+"){\n"+u+"}",s},T.chain=function(t){return T(t).chain()};var L=function(t){return this._chain?T(t).chain():t};T.mixin(T),E(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var n=o[t];T.prototype[t]=function(){var e=this._wrapped;return n.apply(e,arguments),"shift"!=t&&"splice"!=t||0!==e.length||delete e[0],L.call(this,e)}}),E(["concat","join","slice"],function(t){var n=o[t];T.prototype[t]=function(){return L.call(this,n.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return T})}).call(this)},{}],11:[function(t,n,e){e.pickVal=function(t,n){return t+t*n*(1-2*Math.random())},e.floor=function(t,n){return Math.floor(t*Math.pow(10,n))/Math.pow(10,n)},e.valExp=function(t,n){return n=n||2,(Math.exp(t*n)-Math.exp(0))/(Math.exp(n)-Math.exp(0))}},{}],12:[function(t,n,e){e.kickStartWAA=function(){audioContext=new AudioContext;var t=audioContext.createOscillator(),n=audioContext.createGain();return n.gain.value=0,t.connect(n),n.connect(audioContext.destination),t.start(0),t.stop(1),audioContext};var r=e.loadBuffer=function(t,n){a(t,function(e,r){return e?n(e):void u(r,function(e,r){return e?(e instanceof c&&(e.message+=" "+t),n(e)):void n(null,r)})})},o=(e.formatSupport=function(t){var n,e=[],i=[["wav","sounds/format-support/sample.wav"],["mp3","sounds/format-support/sample.mp3"],["ogg","sounds/format-support/sample.ogg"]],o=function(u,a,s){var l;if(a){if(!(a instanceof c))return t(a);l=!1}else l=1===s.numberOfChannels&&50===Math.round(1e3*s.duration)?!0:!1;l===!0&&e.push(u),i.length>0?(n=i.pop(),r(n[1],o.bind(this,n[0]))):t(null,e)};n=i.pop(),r(n[1],o.bind(this,n[0]))},[]);e.plotBuffer=function(t,n){var e=100,r=t.getChannelData(0),u=t.sampleRate,a=n.attr("width")||300,s=n.attr("height")||300,c=[];for(i=0,length=t.length;length>i;i+=e)c.push([i/u,r[i]]);var l=d3.scale.linear().range([0,a]),f=d3.scale.linear().range([s,0]),d=d3.svg.line().x(function(t){return l(t[0])}).y(function(t){return f(t[1])});l.domain(d3.extent(c,function(t){return t[0]})),f.domain(d3.extent(c,function(t){return t[1]})),n.append("path").datum(c).attr("class","plot plot-"+o.length%2).attr("d",d),o.push(t)};var u=function(t,n){audioContext.decodeAudioData(t,function(t){n(null,t)},function(t){n(t||new c("decoding error"),null)})},a=function(t,n){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){200===e.status?n(null,e.response):n(new s(e.statusText))},e.onerror=function(t){n(t||new Error("unexpected request error"),null)},e.send()},s=function(t){this.message=t||""};s.prototype=Object.create(Error.prototype),s.prototype.name="HTTPError";var c=function(t){this.message=t||""};c.prototype=Object.create(Error.prototype),c.prototype.name="DecodeError"},{}],13:[function(t,n,e){var r=t("underscore"),i=!1;$(function(){$("body").on(TouchMouseEvent.DOWN,function(){i=!0}).on(TouchMouseEvent.UP,function(){i=!1})}),e.grid=function(t,n,e){var i=$("<div>",{"class":"grid"}),o=$("<div>",{"class":"buttonsContainer"}),u=$("<button>",{"class":"resetSequenceButton"}).html("Reset").appendTo(o);return r.forEach(r.range(n),function(n){var o=$("<div>",{"class":"track track-"+n}).appendTo(i);r.forEach(r.range(e),function(n){$("<div>",{"class":"step step-"+n}).appendTo(o).click(function(){var e=$(this).attr("class");"toggle"===t&&i.find(".step-"+n).removeClass("active"),$(this).attr("class",e).toggleClass("active")})})}),i.append(o),u.click(function(){i.find(".step").removeClass("active")}),{elem:i,refresh:function(){},setSequence:function(t){var n,e;for(n=0,e=1;e<t.length;n+=2,e+=2)this.elem.find(".track-"+t[n]+" .step-"+t[e]).addClass("active")},getSequence:function(){var t=[];return this.elem.find(".track").each(function(n,e){$(e).find(".step").each(function(e,r){$(r).hasClass("active")&&(t.push(n),t.push(e))})}),t}}},e.toggle=function(t){var n=$("<div>",{"class":"toggle"}).click(function(){$(this).toggleClass("active"),t.call(this,$(this).hasClass("active")?1:0)});return{elem:n,refresh:function(){},setState:function(t){1===t&&n.addClass("active")}}},e.xyPad=function(t,n){var e=$("<div>",{"class":"xyPad"}),r=$("<div>",{"class":"inner"}).appendTo(e),i=$("<div>",{"class":"cursor"}).appendTo(r),o=$('<div class="feedback"><span class="title">'+(t.title||"")+"</span> "+(t.xLabel||"X")+': <span class="x">0</span> | '+(t.yLabel||"Y")+': <span class="y">1</span></div>',{"class":"valueFeedback"}).appendTo(e),u=.04*$(document).width();e.css({padding:u/2}),i.css({width:u,height:u,left:-u/2,top:-u/2});var a=function(t){var e=Math.max(Math.min(t.pageX-r.get(0).offsetLeft,r.width()),0),a=Math.max(Math.min(t.pageY-r.get(0).offsetTop,r.height()),0),s=Math.min(1-a/r.height(),1),c=Math.min(e/r.width(),1);i.css({left:e-u/2,top:a-u/2}),o.find(".x").html(c.toString().slice(0,4)),o.find(".y").html(s.toString().slice(0,4)),n(c,s)},s=function(t){o.find(".x").html(t[0].toString().slice(0,4)),o.find(".y").html(t[1].toString().slice(0,4))};return e.on(TouchMouseEvent.DOWN,function(){e.on(TouchMouseEvent.MOVE,a)}),r.on(TouchMouseEvent.DOWN,a),$("body").on(TouchMouseEvent.UP,function(){e.off(TouchMouseEvent.MOVE)}),{elem:e,_position:[0,0],refresh:function(){this.setPosition(this._position)},setPosition:function(t){this._position=t,s(t),i.css({left:r.width()*t[0]-u/2,top:r.height()*(1-t[1])-u/2})}}},e.slider=function(t,n){var e=$("<div>",{"class":"slider"}),r=$("<div>",{"class":"inner"}).appendTo(e),i=$("<div>",{"class":"cursor"}).appendTo(r),o=$('<div class="feedback"><span class="title">'+(t.title||"")+'</span>: <span class="val">0</span>',{"class":"valueFeedback"}).appendTo(e),u=.04*$(document).width();e.css({paddingLeft:u/2,paddingRight:u/2}),i.css({width:u,height:u,left:-u/2});var a=function(t){var o=Math.max(Math.min(t.pageX-r.get(0).offsetLeft,r.width()),0),a=Math.min(o/e.width(),1);i.css({left:o-u/2}),s(a),n(a)};e.on(TouchMouseEvent.DOWN,function(){e.on(TouchMouseEvent.MOVE,a)}),r.on(TouchMouseEvent.DOWN,a),$("body").on(TouchMouseEvent.UP,function(){e.off(TouchMouseEvent.MOVE)});var s=function(t){o.find(".val").html(t.toString().slice(0,4))};return{elem:e,_val:0,refresh:function(){this.setVal(this._val)},setVal:function(t){this._val=t,s(t),i.css({left:t*r.width()-u/2})}}}},{underscore:10}]},{},[4]);